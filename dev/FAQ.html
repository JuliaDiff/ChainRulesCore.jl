<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FAQ · ChainRules</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/indigo.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.svg" alt="ChainRules logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">ChainRules</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">How to use ChainRules as a rule author</span><ul><li><a class="tocitem" href="rule_author/intro.html">Introduction</a></li><li><a class="tocitem" href="rule_author/example.html">Pedagogical example</a></li><li><a class="tocitem" href="rule_author/tangents.html">Tangent types</a></li><li><a class="tocitem" href="rule_author/which_functions_need_rules.html">Which functions need rules?</a></li><li><a class="tocitem" href="rule_author/rule_definition_tools.html">Rule definition tools</a></li><li><a class="tocitem" href="rule_author/writing_good_rules.html">Writing good rules</a></li><li><a class="tocitem" href="rule_author/testing.html">Testing your rules</a></li><li><input class="collapse-toggle" id="menuitem-2-8" type="checkbox"/><label class="tocitem" for="menuitem-2-8"><span class="docs-label">Superpowers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="rule_author/superpowers/projectto.html"><code>ProjectTo</code></a></li><li><a class="tocitem" href="rule_author/superpowers/opt_out.html"><code>@opt_out</code></a></li><li><a class="tocitem" href="rule_author/superpowers/ruleconfig.html"><code>RuleConfig</code></a></li><li><a class="tocitem" href="rule_author/superpowers/gradient_accumulation.html">Gradient accumulation</a></li></ul></li><li><a class="tocitem" href="rule_author/converting_zygoterules.html">Converting ZygoteRules.@adjoint to rrules</a></li><li><a class="tocitem" href="rule_author/tips_for_packages.html">Tips for making your package work with AD</a></li><li><a class="tocitem" href="rule_author/debug_mode.html">Debug mode</a></li></ul></li><li><span class="tocitem">How to support ChainRules rules as an AD package author</span><ul><li><a class="tocitem" href="ad_author/use_in_ad_system.html">Usage in AD</a></li><li><a class="tocitem" href="ad_author/call_back_into_ad.html">Suport calling back into ADs</a></li><li><a class="tocitem" href="ad_author/opt_out.html">Support opting out of rules</a></li></ul></li><li><span class="tocitem">The maths</span><ul><li><a class="tocitem" href="maths/propagators.html">The propagators: pushforward and pullback</a></li><li><a class="tocitem" href="maths/nondiff_points.html">Non-differentiable Points</a></li><li><a class="tocitem" href="maths/complex.html">Complex numbers</a></li><li><a class="tocitem" href="maths/arrays.html">Deriving array rules</a></li></ul></li><li><span class="tocitem">Design</span><ul><li><a class="tocitem" href="design/changing_the_primal.html">Changing the Primal</a></li><li><a class="tocitem" href="design/many_tangents.html">Many Tangent Types</a></li></ul></li><li><a class="tocitem" href="videos.html">Videos</a></li><li class="is-active"><a class="tocitem" href="FAQ.html">FAQ</a><ul class="internal"><li><a class="tocitem" href="#What-is-up-with-the-different-symbols?"><span>What is up with the different symbols?</span></a></li><li><a class="tocitem" href="#Why-does-rrule-return-the-primal-function-evaluation?"><span>Why does <code>rrule</code> return the primal function evaluation?</span></a></li><li><a class="tocitem" href="#Where-are-the-derivatives-for-keyword-arguments?"><span>Where are the derivatives for keyword arguments?</span></a></li><li><a class="tocitem" href="#faq_abstract_zero"><span>What is the difference between <code>ZeroTangent</code> and <code>NoTangent</code> ?</span></a></li><li><a class="tocitem" href="#When-to-use-ChainRules-vs-ChainRulesCore?"><span>When to use ChainRules vs ChainRulesCore?</span></a></li><li><a class="tocitem" href="#Where-should-I-put-my-rules?"><span>Where should I put my rules?</span></a></li><li><a class="tocitem" href="#How-do-I-test-my-rules?"><span>How do I test my rules?</span></a></li><li><a class="tocitem" href="#Is-removing-a-thunk-a-breaking-change?"><span>Is removing a thunk a breaking change?</span></a></li><li><a class="tocitem" href="#Where-can-I-learn-more-about-AD-?"><span>Where can I learn more about AD ?</span></a></li></ul></li><li><a class="tocitem" href="api.html">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="FAQ.html">FAQ</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="FAQ.html">FAQ</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDiff/ChainRulesCore.jl/blob/main/docs/src/FAQ.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="FAQ"><a class="docs-heading-anchor" href="#FAQ">FAQ</a><a id="FAQ-1"></a><a class="docs-heading-anchor-permalink" href="#FAQ" title="Permalink"></a></h1><h2 id="What-is-up-with-the-different-symbols?"><a class="docs-heading-anchor" href="#What-is-up-with-the-different-symbols?">What is up with the different symbols?</a><a id="What-is-up-with-the-different-symbols?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-up-with-the-different-symbols?" title="Permalink"></a></h2><h3 id="Δx,-x,-dx"><a class="docs-heading-anchor" href="#Δx,-x,-dx"><code>Δx</code>, <code>∂x</code>, <code>dx</code></a><a id="Δx,-x,-dx-1"></a><a class="docs-heading-anchor-permalink" href="#Δx,-x,-dx" title="Permalink"></a></h3><p>ChainRules uses these perhaps atypically. As a notation that is the same across propagators, regardless of direction (in contrast see <code>ẋ</code> and <code>x̄</code> below).</p><ul><li><code>Δx</code> is the input to a propagator, (i.e a <em>seed</em> for a <em>pullback</em>; or a <em>perturbation</em> for a <em>pushforward</em>).</li><li><code>∂x</code> is the output of a propagator.</li><li><code>dx</code> could be either <code>input</code> or <code>output</code>.</li></ul><h3 id="dots-and-bars:-\\dot{y}-\\dfrac{y}{x}-\\overline{x}"><a class="docs-heading-anchor" href="#dots-and-bars:-\\dot{y}-\\dfrac{y}{x}-\\overline{x}">dots and bars: <span>$\dot{y} = \dfrac{∂y}{∂x} = \overline{x}$</span></a><a id="dots-and-bars:-\\dot{y}-\\dfrac{y}{x}-\\overline{x}-1"></a><a class="docs-heading-anchor-permalink" href="#dots-and-bars:-\\dot{y}-\\dfrac{y}{x}-\\overline{x}" title="Permalink"></a></h3><ul><li><code>v̇</code> is a derivative of the input moving forward: <span>$v̇ = \frac{∂v}{∂x}$</span> for input <span>$x$</span>, intermediate value <span>$v$</span>.</li><li><code>v̄</code> is a derivative of the output moving backward: <span>$v̄ = \frac{∂y}{∂v}$</span> for output <span>$y$</span>, intermediate value <span>$v$</span>.</li></ul><h3 id="others"><a class="docs-heading-anchor" href="#others">others</a><a id="others-1"></a><a class="docs-heading-anchor-permalink" href="#others" title="Permalink"></a></h3><ul><li><code>Ω</code> is often used as the return value of the function. Especially, but not exclusively, for scalar functions.<ul><li><code>ΔΩ</code> is thus a seed for the pullback.</li><li><code>∂Ω</code> is thus the output of a pushforward.</li></ul></li></ul><h2 id="Why-does-rrule-return-the-primal-function-evaluation?"><a class="docs-heading-anchor" href="#Why-does-rrule-return-the-primal-function-evaluation?">Why does <code>rrule</code> return the primal function evaluation?</a><a id="Why-does-rrule-return-the-primal-function-evaluation?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-does-rrule-return-the-primal-function-evaluation?" title="Permalink"></a></h2><p>You might wonder why <code>frule(f, x)</code> returns <code>f(x)</code> and the derivative of <code>f</code> at <code>x</code>, and similarly for <code>rrule</code> returning <code>f(x)</code> and the pullback for <code>f</code> at <code>x</code>. Why not just return the pushforward/pullback, and let the user call <code>f(x)</code> to get the answer separately?</p><p>There are three reasons the rules also calculate the <code>f(x)</code>.</p><ol><li>For some rules an alternative way of calculating <code>f(x)</code> can give the same answer while also generating intermediate values that can be used in the calculations required to propagate the derivative.</li><li>For many <code>rrule</code>s the output value is used in the definition of the pullback. For example <code>tan</code>, <code>sigmoid</code> etc.</li><li>For some <code>frule</code>s there exists a single, non-separable operation that will compute both derivative and primal result. For example, this is the case for many of the methods for <a href="https://docs.juliadiffeq.org/stable/analysis/sensitivity/#sensitivity-1">differential equation sensitivity analysis</a>.</li></ol><p>For more information and examples see the <a href="design/changing_the_primal.html#change_primal">design notes on changing the primal</a>.</p><h2 id="Where-are-the-derivatives-for-keyword-arguments?"><a class="docs-heading-anchor" href="#Where-are-the-derivatives-for-keyword-arguments?">Where are the derivatives for keyword arguments?</a><a id="Where-are-the-derivatives-for-keyword-arguments?-1"></a><a class="docs-heading-anchor-permalink" href="#Where-are-the-derivatives-for-keyword-arguments?" title="Permalink"></a></h2><p><em>Pullbacks</em> do not return a sensitivity for keyword arguments; similarly, <em>pushforwards</em> do not accept a perturbation for keyword arguments. This is because in practice functions are very rarely differentiable with respect to keyword arguments.</p><p>As a rule, keyword arguments tend to control side-effects, like logging verbosity, or to be functionality-changing to perform a different operation, e.g. <code>dims=3</code>, and thus not differentiable.</p><p>To the best of our knowledge no Julia AD system, with support for the definition of custom primitives, supports differentiating with respect to keyword arguments. At some point in the future ChainRules may support these. Maybe.</p><h2 id="faq_abstract_zero"><a class="docs-heading-anchor" href="#faq_abstract_zero">What is the difference between <code>ZeroTangent</code> and <code>NoTangent</code> ?</a><a id="faq_abstract_zero-1"></a><a class="docs-heading-anchor-permalink" href="#faq_abstract_zero" title="Permalink"></a></h2><p><code>ZeroTangent</code> and <code>NoTangent</code> act almost exactly the same in practice: they result in no change whenever added to anything. Odds are if you write a rule that returns the wrong one everything will just work fine. We provide both to allow for clearer writing of rules, and easier debugging.</p><p><code>ZeroTangent()</code> represents the fact that if one perturbs (adds a small change to) the matching primal, there will be no change in the behaviour of the primal function. For example, in <code>fst(x, y) = x</code>, the derivative of <code>fst</code> with respect to <code>y</code> is <code>ZeroTangent()</code>. <code>fst(10, 5) == 10</code> and if we add <code>0.1</code> to <code>5</code> we still get <code>fst(10, 5.1) == 10</code>.</p><p><code>NoTangent()</code> represents the fact that if one perturbs the matching primal, the primal function will now error. For example, in <code>access(xs, n) = xs[n]</code>, the derivative of <code>access</code> with respect to <code>n</code> is <code>NoTangent()</code>. <code>access([10, 20, 30], 2) == 20</code>, but if we add <code>0.1</code> to <code>2</code> we get <code>access([10, 20, 30], 2.1)</code> which errors as indexing can&#39;t be applied at fractional indexes.</p><h2 id="When-to-use-ChainRules-vs-ChainRulesCore?"><a class="docs-heading-anchor" href="#When-to-use-ChainRules-vs-ChainRulesCore?">When to use ChainRules vs ChainRulesCore?</a><a id="When-to-use-ChainRules-vs-ChainRulesCore?-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-use-ChainRules-vs-ChainRulesCore?" title="Permalink"></a></h2><p><a href="https://github.com/JuliaDiff/ChainRulesCore.jl">ChainRulesCore.jl</a> is a light-weight dependency for defining rules for functions in your packages, without you needing to depend on ChainRules.jl itself. It has almost no dependencies of its own. If you only want to define rules, not use them, then you probably only want to load ChainRulesCore.jl.</p><p><a href="https://github.com/JuliaDiff/ChainRules.jl">ChainRules.jl</a> provides the full functionality for AD systems. In particular, it has all the rules for Base Julia and the standard libraries. It is thus a much heavier package to load. AD systems making use of <code>frule</code>s and <code>rrule</code>s should load ChainRules.jl.</p><h2 id="Where-should-I-put-my-rules?"><a class="docs-heading-anchor" href="#Where-should-I-put-my-rules?">Where should I put my rules?</a><a id="Where-should-I-put-my-rules?-1"></a><a class="docs-heading-anchor-permalink" href="#Where-should-I-put-my-rules?" title="Permalink"></a></h2><p>We recommend adding custom rules to your own packages with <a href="https://github.com/JuliaDiff/ChainRulesCore.jl">ChainRulesCore.jl</a>. It is good to have them in the same package that defines the original function. This avoids type-piracy, and makes it easy to keep in-sync. ChainRulesCore is a very light-weight dependency.</p><h2 id="How-do-I-test-my-rules?"><a class="docs-heading-anchor" href="#How-do-I-test-my-rules?">How do I test my rules?</a><a id="How-do-I-test-my-rules?-1"></a><a class="docs-heading-anchor-permalink" href="#How-do-I-test-my-rules?" title="Permalink"></a></h2><p>You can use <a href="https://github.com/JuliaDiff/ChainRulesTestUtils.jl">ChainRulesTestUtils.jl</a> to test your custom rules. ChainRulesTestUtils.jl has some dependencies, so it is a separate package from ChainRulesCore.jl. This means your package can depend on the light-weight ChainRulesCore.jl, and make ChainRulesTestUtils.jl a test-only dependency.</p><p>Remember to read the section <a href="rule_author/writing_good_rules.html#On-writing-good-rrule-/-frule-methods">On writing good <code>rrule</code> / <code>frule</code> methods</a>.</p><h2 id="Is-removing-a-thunk-a-breaking-change?"><a class="docs-heading-anchor" href="#Is-removing-a-thunk-a-breaking-change?">Is removing a thunk a breaking change?</a><a id="Is-removing-a-thunk-a-breaking-change?-1"></a><a class="docs-heading-anchor-permalink" href="#Is-removing-a-thunk-a-breaking-change?" title="Permalink"></a></h2><p>Removing thunks is not considered a breaking change. This is because (in principle) removing them changes the implementation of the values returned by an <code>rrule</code>, not the value that they represent. This is morally the same as similar issues <a href="https://github.com/SciML/ColPrac#changes-that-are-not-considered-breaking">discussed in ColPrac</a>, such as details of floating point arithmetic changing.</p><p>On a practical level, it&#39;s important that this is the case because thunks are a bit of a hack, and over time it is hoped that the need for them will reduce, as they increase code-complexity and place additional stress on the compiler.</p><h2 id="Where-can-I-learn-more-about-AD-?"><a class="docs-heading-anchor" href="#Where-can-I-learn-more-about-AD-?">Where can I learn more about AD ?</a><a id="Where-can-I-learn-more-about-AD-?-1"></a><a class="docs-heading-anchor-permalink" href="#Where-can-I-learn-more-about-AD-?" title="Permalink"></a></h2><p>There are not so many truly excellent learning resources for autodiff out there in the world, which is a bit sad. The list here is incomplete, but is vetted for quality.</p><ul><li><p><a href="https://www.youtube.com/watch?v=FtnkqIsfNQc">Automatic Differentiation for Dummies keynote video</a> by <a href="https://github.com/simonpj">Simon Peyton Jones</a>: particularly good if you like pure math type thinking.</p></li><li><p><a href="https://github.com/google-research/dex-lang/issues/454#issuecomment-766089519">&quot;What types work with differentiation?</a> comment on DexLang GitHub issue by <a href="https://github.com/dan-zheng">Dan Zheng</a>: summarizes several years of insights from the Swift AD work.</p></li><li><p>MIT 18337 lecture notes 8-10 (by <a href="https://github.com/ChrisRackauckas">Christopher Rackauckas</a> and <a href="https://github.com/dpsanders">David P. Sanders</a>  : moves fast from basic to advanced, particularly good if you like applicable mathematics</p><ul><li><a href="https://mitmath.github.io/18337/lecture8/automatic_differentiation">Automatic Differentiation and Application</a>: Good introduction</li><li><a href="https://mitmath.github.io/18337/lecture9/stiff_odes">Solving Stiff Ordinary Differential Equations</a>: ignore the ODE stuff, most of this is about Sparse AutoDiff, can skip/skim this one</li><li><a href="https://mitmath.github.io/18337/lecture10/estimation_identification">Basic Parameter Estimation, Reverse-Mode AD, and Inverse Problems</a>: use in optimization, and details connections of other math.</li><li><a href="https://mitmath.github.io/18337/lecture11/adjoints">Differentiable Programming and Neural Differential Equations</a>: Includes custom primitive derivations for equation solvers.</li></ul></li><li><p><a href="https://github.com/MikeInnes/diff-zoo">Diff-Zoo Jupyter Notebook Book</a>  (by <a href="https://github.com/MikeInnes/diff-zoo">Mike Innes</a>, has implementations and explanations.</p></li><li><p><a href="https://dl.acm.org/doi/book/10.5555/1455489">&quot;Evaluating Derivatives&quot;</a> (by Griewank and Walther) is the best book at least for reverse-mode. It also covers forward-mode though (by its own admission) not as well, it never mentioned dual numbers which is an unfortunate lack.</p></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="videos.html">« Videos</a><a class="docs-footer-nextpage" href="api.html">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Wednesday 31 August 2022 04:25">Wednesday 31 August 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
